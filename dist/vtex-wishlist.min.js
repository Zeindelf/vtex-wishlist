// VtexWishlist.js
// version: 0.0.3
// author: Wellington Barreto
// license: MIT
!function t(e,s,i){function o(r,a){if(!s[r]){if(!e[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=s[r]={exports:{}};e[r][0].call(d.exports,function(t){var s=e[r][1][t];return o(s||t)},d,d.exports,t,e,s,i)}return s[r].exports}for(var n="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),r=t("./../data/defaults.js"),a=i(r),u=t("./../data/data.js"),l=i(u),d=t("./../utils/helpers.js"),c=i(d),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this.options=c.default.extend({},a.default,c.default.isPlainObject(e)&&e),this.validate(),this.init()}return n(t,[{key:"validate",value:function(){if(void 0===window.store)throw new Error("Store.js is required. Download it from https://www.npmjs.com/package/store");if(window.store.version<"2.0.12")throw new Error("Store.js 2.0.12 is required. Download it from https://www.npmjs.com/package/store");if(void 0===window.VtexHelpers)throw new Error("VtexHelpers is required. Download it from https://www.npmjs.com/package/vtex-helpers");if(!this.options.storeName||!c.default.isString(this.options.storeName))throw new Error('The option "storeName" is required and must be a string.');if(!this.options.wishlistEntity||!c.default.isString(this.options.wishlistEntity))throw new Error('The option "wishlistEntity" is required and must be a string.');if(!this.options.shelfId||!c.default.isString(this.options.shelfId))throw new Error('The option "shelfId" is required and must be a string.');if(null===this.options.notFound)this.options.notFound=function(){return'<div class="wishlist__not-found">Nenhum produto em sua lista</div>'};else{if(!c.default.isFunction(this.options.notFound))throw new Error('The option "notFound" must be a function.');this.options.notFound.call(this)}}},{key:"init",value:function(){var t=this;this.storageName=c.default.strReplace(["{storeName}","-"],[this.options.storeName,"_"],l.default.storageName),this.storage=window.store,this.vtexHelpers=new VtexHelpers,window.console.log(this),this.initStorage(),this.storageObserve(),this.setWishlistProduct(),this.setUserEmail(),$(document).on("ajaxStop",function(){return t.storageObserve()})}},{key:"setWishlistProduct",value:function(){var t=this;$(document).on("click","[data-wishlist-add]",function(e){e.preventDefault();var s=$(e.currentTarget),i=s.data("wishlistProductId");return t.checkUserEmail()?(s.addClass(t.options.loaderClass),s.hasClass(t.options.activeClass)?(setTimeout(function(){s.removeClass(t.options.activeClass),s.attr("title",t.options.linkTitle.add),t.deleteWishlistProducts(i),s.removeClass(t.options.loaderClass)},1e3),!1):void setTimeout(function(){s.addClass(t.options.activeClass),s.attr("title",t.options.linkTitle.remove),t.saveWishlistProducts(i),s.removeClass(t.options.loaderClass)},1e3)):(t.getUserEmail(),!1)})}},{key:"checkUserEmail",value:function(){return null!==this.storage.get(this.storageName).userEmail}},{key:"getUserEmail",value:function(){var t=this;this.vtexHelpers.checkLogin().done(function(t){}).fail(function(e){e.IsUserDefined||t.vtexHelpers.openPopupLogin()})}},{key:"setUserEmail",value:function(){var t=this;this.vtexHelpers.checkLogin().done(function(e){if(e.IsUserDefined){var s=t.storage.get(t.storageName);s.userEmail=e.Email,t.storage.set(t.storageName,s)}}).fail(function(t){})}},{key:"saveWishlistProducts",value:function(t){var e=this.storage.get(this.storageName);e.productsId.some(function(e){return e===t})||(e.productsId.push(t),this.storage.set(this.storageName,e))}},{key:"deleteWishlistProducts",value:function(t){var e=this.storage.get(this.storageName);if(e.productsId.some(function(e){return e===t})){var s=e.productsId.filter(function(e){return e!==t});e.productsId=s,this.storage.set(this.storageName,e)}}},{key:"initStorage",value:function(){void 0===this.storage.get(this.storageName)&&this.storage.set(this.storageName,{userEmail:null,productsId:[]})}},{key:"storageObserve",value:function(){var t=this;void 0!==this.storage.get(this.storageName)?this.storage.observe(this.storageName,function(e,s){var i=$(document).find("[data-wishlist-add]");$("[data-wishlist-amount]").text(e.productsId.length),e.productsId.map(function(e){i.map(function(s,i){e===$(i).data("wishlistProductId")&&$(i).addClass(t.options.activeClass)})})}):$("[data-wishlist-amount]").text("0")}}]),t}();s.default=f},{"./../data/data.js":2,"./../data/defaults.js":3,"./../utils/helpers.js":5}],2:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default={storageName:"{storeName}_wishlist",masterdataUrl:"//api.vtexcrm.com.br/{storeName}/dataentities/{entity}/{type}/"}},{}],3:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default={appendTo:".js--wishlist-items",activeClass:"is--active",loaderClass:"has--wishlist-loader",linkTitle:{add:"Adicionar a wishlist",remove:"Remover da wishlist"},notFound:null}},{}],4:[function(t,e,s){"use strict";var i=t("./class/VtexWishlist.js"),o=function(t){return t&&t.__esModule?t:{default:t}}(i);void 0===window.VtexWishlist&&(window.VtexWishlist=o.default),document.addEventListener("DOMContentLoaded",function(){new o.default({storeName:"mob",wishlistEntity:"WL",shelfId:"2d5c05cd-75d7-42aa-b9b3-c4824ac2063a",appendTo:".js--wishlist-items",loaderClass:"has--wishlist-loader",activeClass:"is--active",linkTitle:{add:"Adicionar a wishlist",remove:"Remover da wishlist"},notFound:function(){return'<div class="wishlist__not-found">Nenhum produto em sua lista</div>'}})})},{"./class/VtexWishlist.js":1}],5:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};s.default={extend:function(t){for(var e=this,s=arguments.length,i=Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];if(this.isObject(t)&&i.length>0){if(Object.assign)return Object.assign.apply(Object,[t].concat(i));i.forEach(function(s){e.isObject(s)&&Object.keys(s).forEach(function(e){t[e]=s[e]})})}return t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isUndefined:function(t){return void 0===t},isObject:function(t){return"object"===(void 0===t?"undefined":i(t))&&null!==t},isPlainObject:function(t){if(!this.isObject(t))return!1;try{var e=t.constructor,s=e.prototype;return e&&s&&hasOwnProperty.call(s,"isPrototypeOf")}catch(t){return!1}},isFunction:function(t){return"function"==typeof t},strReplace:function(t,e,s){var i=void 0;if(t instanceof Array)for(var o=0;o<t.length;o++)t[o]=t[o].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=new RegExp(t[o],"g"),s=s.replace(i,e instanceof Array?e[o]:e);else t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=new RegExp(t,"g"),s=s.replace(i,e instanceof Array?e[0]:e);return s}}},{}]},{},[4]);
